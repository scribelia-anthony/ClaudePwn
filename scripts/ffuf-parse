#!/usr/bin/env python3
"""Parse ffuf JSON output into clean, readable results."""
import json
import sys

def parse(path):
    with open(path) as f:
        data = json.load(f)

    results = data.get("results", [])
    if not results:
        print("Aucun rÃ©sultat.")
        return

    # Group by status code
    by_status = {}
    for r in results:
        fuzz = r.get("input", {}).get("FUZZ", "")
        if not fuzz or fuzz.startswith("#"):
            continue
        status = r.get("status", 0)
        by_status.setdefault(status, []).append(r)

    for status in sorted(by_status):
        entries = sorted(by_status[status], key=lambda r: r.get("length", 0))
        for r in entries:
            length = r.get("length", 0)
            url = r.get("url", "")
            words = r.get("words", 0)
            print(f"[{status}] {length:>6}b {words:>4}w  {url}")

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print(f"Usage: ffuf-parse <fichier.json>")
        sys.exit(1)
    parse(sys.argv[1])
